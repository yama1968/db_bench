Starting Impala Shell without Kerberos authentication
Connected to quickstart.cloudera:21000
Server version: impalad version 2.7.0-cdh5.9.1 RELEASE (build 24ad6df788d66e4af9496edb26ac4d1f1d2a1f2c)
Query: /*

*/



drop view if exists dt_per_day
Query submitted at: 2017-01-31 12:09:46 (Coordinator: http://quickstart.cloudera:25000)
Query progress can be monitored at: http://quickstart.cloudera:25000/query_plan?query_id=ad4c26b72dc059a9:ce92144f00000000

Fetched 0 row(s) in 0.00s
Query: drop view if exists device_plus_dt
Query: drop view if exists train3
Query: create view train3
  as select *, 
            cast(substring(hour, 5, 2) as int) as int_day, 
            cast(substring(hour, 7, 2) as int) as int_hour
       from train
Query submitted at: 2017-01-31 12:09:46 (Coordinator: http://quickstart.cloudera:25000)
Query progress can be monitored at: http://quickstart.cloudera:25000/query_plan?query_id=f049b88b3e4fd449:f060ccd700000000

Fetched 0 row(s) in 0.12s
Query: create view device_plus_dt
  as select device_id, 
            device_ip, 
            int_day, 
            int_hour, 
            int_hour - lag(int_hour) over (partition by device_id, device_ip, int_day order by id) as dt_hour
       from train3
Query submitted at: 2017-01-31 12:09:46 (Coordinator: http://quickstart.cloudera:25000)
Query progress can be monitored at: http://quickstart.cloudera:25000/query_plan?query_id=a94691166a657dc4:3ef831de00000000

Fetched 0 row(s) in 3.64s
Query: create view dt_per_day
  as select int_day,
            sum(dt_hour) as sum_dt_hour,
            count(dt_hour) as num_per_day,
            sum_dt_hour / num_per_day as avg_per_day
       from device_plus_dt
   group by int_day
Query submitted at: 2017-01-31 12:09:50 (Coordinator: http://quickstart.cloudera:25000)
ERROR: AnalysisException: Could not resolve column/field reference: 'sum_dt_hour'

Could not execute command: create view dt_per_day
  as select int_day,
            sum(dt_hour) as sum_dt_hour,
            count(dt_hour) as num_per_day,
            sum_dt_hour / num_per_day as avg_per_day
       from device_plus_dt
   group by int_day

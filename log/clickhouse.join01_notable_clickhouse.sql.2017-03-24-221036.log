

SELECT click, count(*)
  FROM (
        SELECT id, hour as my_hour, click, device_id, p, nnb
          FROM Train AS t
          ALL INNER JOIN (
                SELECT device_id, count(*) as nnb, avg(click) as p
                  FROM Train
                 GROUP BY device_id
            ) AS DID
            USING(device_id)
    ) AS A
 GROUP BY click
 ORDER BY click
0	33563901
1	6865066
1.913
SELECT id, hour as my_hour, click, device_id, p, nnb
   FROM Train AS t
   ALL INNER JOIN (
         SELECT device_id, count(*) as nnb, avg(click) as p
           FROM Train
          GROUP BY device_id
     ) AS DID
     USING(device_id)
     ORDER BY p DESC
     LIMIT 20
10000667024872601741	14102219	1	6228fa6e	1	1
10000321542944766592	14102612	1	e407d618	1	1
14055683177806105069	14102608	1	cc4f339a	1	2
10366093242900465438	14102214	1	ebf57ab8	1	1
10822969540524969330	14102505	1	c6a87c2f	1	1
11643524664039633829	14102514	1	26da314d	1	2
13091917591454111284	14102618	1	e7baa20b	1	1
16273902757152629772	14102322	1	3d44a742	1	1
9312706585849881008	14102222	1	420557e6	1	1
9979668707174206106	14102302	1	d8fccfb6	1	1
10000943463202967882	14102218	1	d6ff54c4	1	1
10000260426386904672	14102307	1	f20b57db	1	2
14055850951186991389	14102602	1	9e59f003	1	1
10365534027251566471	14102505	1	6d3b6640	1	1
10822704489854000504	14103016	1	ef475fed	1	1
11643808842286015928	14103013	1	b9d455a5	1	1
13092161028050719126	14102917	1	cd2333b4	1	1
16273594749444567451	14102923	1	7776c991	1	1
9313010331608734834	14102221	1	4c7cf476	1	3
9979897656469818699	14102821	1	2929ffd1	1	4
3.154



SELECT click, count(*)
  FROM (
        SELECT id, hour as my_hour, click, device_id, p, nnb
          FROM Train AS t
          ALL INNER JOIN (
                SELECT device_id, count(*) as nnb, avg(click) as p
                  FROM Train
                 GROUP BY device_id
            ) AS DID
            USING(device_id)
    ) AS A
 GROUP BY click
 ORDER BY click
0	33563901
1	6865066
2.305
SELECT id, hour as my_hour, click, device_id, p, nnb
   FROM Train AS t
   ALL INNER JOIN (
         SELECT device_id, count(*) as nnb, avg(click) as p
           FROM Train
          GROUP BY device_id
     ) AS DID
     USING(device_id)
     ORDER BY p DESC
     LIMIT 20
10000779334277828801	14102209	1	da6925a5	1	1
10000667024872601741	14102219	1	6228fa6e	1	1
10092709012375319757	14102812	1	8650c8d7	1	1
10341777953972277193	14102409	1	15ae5745	1	1
10549233732935905758	14102723	1	27d199e0	1	1
11546053183069229436	14102414	1	e05f1f0f	1	1
13091917591454111284	14102618	1	e7baa20b	1	1
2546685715284838159	14102910	1	9c4a58d0	1	1
8142760861593050862	14102518	1	9b209908	1	1
9979668707174206106	14102302	1	d8fccfb6	1	1
10000009096807152757	14102703	1	bda21d94	1	2
10000943463202967882	14102218	1	d6ff54c4	1	1
10092167541412897800	14102518	1	5d1ba083	1	2
10342624699542665021	14102705	1	db0cfe63	1	1
10549772124184424784	14102510	1	bb272e72	1	1
11546232450455134340	14102416	1	04c4d94c	1	1
13092161028050719126	14102917	1	cd2333b4	1	1
2546321965078886587	14102916	1	2ea001bb	1	1
8141138682076962858	14102219	1	2f80c121	1	1
9979897656469818699	14102821	1	2929ffd1	1	4
3.225

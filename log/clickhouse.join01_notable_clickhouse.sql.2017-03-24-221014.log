

SELECT click, count(*)
  FROM (
        SELECT id, hour as my_hour, click, device_id, p, nnb
          FROM Train AS t
          ALL INNER JOIN (
                SELECT device_id, count(*) as nnb, avg(click) as p
                  FROM Train
                 GROUP BY device_id
            ) AS DID
            USING(device_id)
    ) AS A
 GROUP BY click
 ORDER BY click
0	33563901
1	6865066
2.019
SELECT id, hour as my_hour, click, device_id, p, nnb
   FROM Train AS t
   ALL INNER JOIN (
         SELECT device_id, count(*) as nnb, avg(click) as p
           FROM Train
          GROUP BY device_id
     ) AS DID
     USING(device_id)
     ORDER BY p DESC
     LIMIT 20
10000321542944766592	14102612	1	e407d618	1	1
10081149215397292657	14102601	1	f2482ac8	1	1
10241640260643072546	14102117	1	505d49f9	1	4
10184199613906574665	14102809	1	3f224c38	1	1
10256917530054475562	14102713	1	4780e000	1	1
1103161026534433913	14102912	1	677b3b3a	1	1
16832253870765199416	14102613	1	8141fb80	1	2
2845728724736060845	14102115	1	eb216546	1	1
5049379250461095957	14102810	1	43ef4369	1	1
9943113057729953021	14103016	1	bc9cde12	1	1
10000260426386904672	14102307	1	f20b57db	1	2
10081369203365966329	14102311	1	15890c90	1	3
1024139935327474050	14102608	1	3716b653	1	1
10183325562274266765	14102516	1	9159c5c3	1	1
10257791417310343151	14102917	1	d3dce1bb	1	1
110315177966543729	14102121	1	81400153	1	1
16830998192107679623	14102602	1	e4c39654	1	7
2845661606517818701	14102107	1	5fcec095	1	1
5050612234876888955	14102802	1	b6c6d573	1	1
9943129805905069752	14102806	1	99339df7	1	1
9.353

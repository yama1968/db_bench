DROP TABLE: no such table 'device_id_nb_tmp'
create table device_id_nb_tmp
       as select device_id, count(*) as nnb, avg(click) as p
       from train
       group by device_id
       with data;
operation successful (8.6s)
ALTER TABLE: no such column 'nnb'
alter table train
      add nnb integer;
operation successful (18.8s)
update train
       set nnb = (select dt.nnb from device_id_nb_tmp dt
                             where train.device_id = dt.device_id);
40428967 affected rows (69.9s)
select annb, count(*)
       from (select device_id, avg(nnb) as annb
                    from train
                    group by device_id) as foo
       group by annb
       order by annb asc;
+--------------------------+---------+
| annb                     | L2      |
+==========================+=========+
|                        1 | 1690039 |
|                        2 |  425521 |
|                        3 |  189086 |
|                        4 |  103581 |
|                        5 |   64075 |
|                        6 |   42727 |
|                        7 |   30329 |
|                        8 |   22348 |
|                        9 |   17254 |
|                       10 |   13467 |
|                       11 |   10745 |
|                       12 |    9073 |
|                       13 |    7403 |
|                       14 |    6307 |
|                       15 |    5131 |
|                       16 |    4477 |
|                       17 |    3924 |
|                       18 |    3420 |
|                       19 |    3049 |
|                       20 |    2693 |
|                       21 |    2402 |
|                       22 |    2097 |
|                       23 |    1886 |
|                       24 |    1725 |
|                       25 |    1528 |
|       25.000000000000004 |       2 |
|                       26 |    1381 |
|                       27 |    1357 |
|                       28 |    1199 |
|                       29 |    1026 |
|                       30 |     962 |
|                       31 |     989 |
|                       32 |     845 |
|                       33 |     757 |
|                       34 |     683 |
|                       35 |     692 |
|                       36 |     613 |
|                       37 |     570 |
|                       38 |     539 |
|                       39 |     511 |
|                       40 |     487 |
|                       41 |     410 |
|       41.000000000000007 |       1 |
|                       42 |     377 |
|                       43 |     372 |
|       43.000000000000007 |       1 |
|                       44 |     369 |
|                       45 |     319 |
|                       46 |     296 |
|                       47 |     277 |
|                       48 |     288 |
|                       49 |     228 |
|                       50 |     248 |
|       50.000000000000007 |       1 |
|                       51 |     236 |
|                       52 |     233 |
|                       53 |     219 |
|                       54 |     195 |
|                       55 |     208 |
|                       56 |     164 |
|                       57 |     160 |
|                       58 |     156 |
|                       59 |     164 |
|                       60 |     155 |
|                       61 |     145 |
|                       62 |     130 |
|                       63 |     123 |
|                       64 |     125 |
|                       65 |     116 |
|                       66 |      92 |
|                       67 |     111 |
|                       68 |     101 |
|                       69 |      88 |
|                       70 |     101 |
|                       71 |      99 |
|                       72 |      80 |
|                       73 |      78 |
|                       74 |      69 |
|                       75 |      84 |
|                       76 |     100 |
|                       77 |      67 |
|                       78 |      64 |
|                       79 |      54 |
|                       80 |      50 |
|                       81 |      54 |
|                       82 |      60 |
|                       83 |      54 |
|                       84 |      57 |
|                       85 |      56 |
|                       86 |      60 |
|                       87 |      49 |
|                       88 |      50 |
|                       89 |      34 |
|                       90 |      45 |
|                       91 |      33 |
|                       92 |      34 |
|       92.000000000000014 |       1 |
|                       93 |      32 |
|                       94 |      34 |
|                       95 |      38 |
|                       96 |      28 |
|                       97 |      33 |
|                       98 |      33 |
|                       99 |      29 |
|                      100 |      34 |
|                      101 |      23 |
|                      102 |      33 |
|                      103 |      34 |
|                      104 |      30 |
|                      105 |      33 |
|                      106 |      26 |
|                      107 |      26 |
|                      108 |      21 |
|                      109 |      24 |
|                      110 |      18 |
|                      111 |      18 |
|                      112 |      20 |
|                      113 |      22 |
|                      114 |      22 |
|                      115 |      32 |
|                      116 |      24 |
|                      117 |      21 |
|                      118 |      22 |
|                      119 |      17 |
|                      120 |      13 |
|                      121 |      17 |
|                      122 |      28 |
|                      123 |      27 |
|                      124 |      14 |
|                      125 |      11 |
|                      126 |      21 |
|                      127 |      11 |
|                      128 |      16 |
|                      129 |      17 |
|                      130 |      14 |
|                      131 |      16 |
|                      132 |       9 |
|                      133 |      18 |
|                      134 |      13 |
|                      135 |       9 |
|                      136 |      16 |
|                      137 |      12 |
|                      138 |       9 |
|                      139 |      16 |
|                      140 |      17 |
|                      141 |       9 |
|                      142 |      15 |
|                      143 |      17 |
|                      144 |      13 |
|                      145 |      12 |
|                      146 |      14 |
|                      147 |      12 |
|                      148 |       9 |
|                      149 |       5 |
|                      150 |       7 |
|                      151 |      12 |
|                      152 |       9 |
|                      153 |      12 |
|                      154 |       7 |
|                      155 |       9 |
|                      156 |       9 |
|                      157 |      12 |
|                      158 |       6 |
|                      159 |       6 |
|                      160 |       8 |
|                      161 |       6 |
|                      162 |       9 |
|                      163 |       8 |
|                      164 |      13 |
|                      165 |       6 |
|                      166 |      10 |
|                      167 |      10 |
|                      168 |       9 |
|                      169 |      10 |
|                      170 |       7 |
|                      171 |       9 |
|                      172 |       7 |
|                      173 |       4 |
|                      174 |       7 |
|                      175 |       7 |
|                      176 |       6 |
|                      177 |       2 |
|                      178 |       7 |
|                      179 |       5 |
|                      180 |       8 |
|                      181 |       3 |
|                      182 |       5 |
|                      183 |       7 |
|                      184 |       4 |
|                      185 |       4 |
|                      186 |      11 |
|                      187 |       1 |
|                      188 |       7 |
|                      189 |       3 |
|                      190 |       9 |
|                      191 |       4 |
|                      192 |       6 |
|                      193 |       5 |
|                      194 |       4 |
|                      195 |       3 |
|                      196 |       7 |
|                      197 |       5 |
|                      198 |       3 |
|                      199 |       3 |
|                      200 |       4 |
|                      201 |       3 |
|                      202 |       5 |
|                      203 |       4 |
|                      204 |       5 |
|                      205 |       8 |
|                      206 |       1 |
|                      207 |       3 |
|                      208 |       2 |
|                      209 |       2 |
|                      210 |       7 |
|                      211 |       3 |
|                      212 |       3 |
|                      213 |       4 |
|                      214 |       8 |
|                      215 |       5 |
|                      216 |       1 |
|                      217 |       3 |
|                      218 |       1 |
|                      219 |       4 |
|                      220 |       5 |
|                      221 |       4 |
|                      222 |       7 |
|                      223 |       4 |
|                      224 |       5 |
|                      225 |       4 |
|                      226 |       2 |
|                      227 |       1 |
|                      228 |       1 |
|                      229 |       5 |
|                      231 |       3 |
|                      232 |       5 |
|                      233 |       2 |
|                      234 |       5 |
|                      235 |       2 |
|                      236 |       3 |
|                      237 |       2 |
|                      238 |       4 |
|                      239 |       2 |
|                      240 |       4 |
|                      241 |       3 |
|                      242 |       2 |
|                      243 |       2 |
|                      244 |       1 |
|                      245 |       2 |
|                      246 |       3 |
|                      247 |       2 |
|                      248 |       3 |
|                      250 |       2 |
|                      251 |       3 |
|                      252 |       4 |
|                      253 |       4 |
|                      255 |       3 |
|                      256 |       2 |
|                      257 |       1 |
|                      258 |       3 |
|                      259 |       2 |
|                      260 |       3 |
|                      261 |       1 |
|                      262 |       1 |
|                      263 |       4 |
|                      264 |       2 |
|                      265 |       1 |
|                      266 |       2 |
|                      267 |       2 |
|                      268 |       3 |
|                      269 |       3 |
|                      270 |       1 |
|                      271 |       4 |
|                      272 |       2 |
|                      273 |       6 |
|                      274 |       2 |
|                      275 |       3 |
|                      276 |       2 |
|                      278 |       2 |
|                      280 |       1 |
|                      281 |       3 |
|                      282 |       1 |
|                      283 |       2 |
|                      284 |       2 |
|                      285 |       1 |
|                      286 |       1 |
|                      287 |       1 |
|                      288 |       4 |
|                      289 |       1 |
|                      290 |       1 |
|                      293 |       2 |
|                      294 |       2 |
|                      296 |       1 |
|                      297 |       1 |
|                      298 |       3 |
|                      301 |       1 |
|                      303 |       2 |
|                      304 |       1 |
|                      305 |       2 |
|                      307 |       1 |
|                      308 |       1 |
|                      310 |       1 |
|                      311 |       1 |
|                      312 |       4 |
|                      314 |       2 |
|                      315 |       2 |
|                      316 |       2 |
|                      318 |       2 |
|                      319 |       3 |
|                      320 |       1 |
|                      321 |       1 |
|                      322 |       1 |
|                      323 |       1 |
|                      325 |       1 |
|                      326 |       1 |
|                      327 |       1 |
|                      329 |       1 |
|                      331 |       1 |
|                      332 |       3 |
|                      333 |       1 |
|                      334 |       1 |
|                      336 |       1 |
|                      341 |       1 |
|                      344 |       1 |
|                      345 |       1 |
|                      348 |       2 |
|                      350 |       1 |
|                      353 |       1 |
|                      354 |       1 |
|                      356 |       1 |
|                      357 |       2 |
|                      358 |       1 |
|                      359 |       4 |
|                      364 |       1 |
|                      365 |       1 |
|                      367 |       1 |
|                      369 |       2 |
|                      373 |       3 |
|                      374 |       1 |
|                      375 |       2 |
|                      376 |       2 |
|                      377 |       1 |
|                      378 |       1 |
|                      381 |       1 |
|                      382 |       2 |
|                      383 |       1 |
|                      385 |       2 |
|                      386 |       1 |
|                      387 |       2 |
|                      388 |       1 |
|                      395 |       2 |
|                      396 |       2 |
|                      397 |       1 |
|                      400 |       1 |
|                      402 |       1 |
|                      407 |       1 |
|                      408 |       1 |
|                      410 |       2 |
|                      411 |       1 |
|                      412 |       1 |
|                      415 |       2 |
|                      416 |       1 |
|                      417 |       1 |
|                      419 |       3 |
|                      421 |       2 |
|                      423 |       2 |
|                      424 |       1 |
|                      430 |       1 |
|                      433 |       1 |
|                      438 |       1 |
|                      439 |       1 |
|                      442 |       1 |
|                      446 |       3 |
|                      448 |       2 |
|                      450 |       1 |
|                      454 |       1 |
|                      461 |       1 |
|                      462 |       1 |
|                      464 |       1 |
|                      467 |       1 |
|                      472 |       1 |
|                      474 |       1 |
|                      475 |       1 |
|                      476 |       1 |
|                      477 |       1 |
|                      479 |       1 |
|                      480 |       1 |
|                      485 |       1 |
|                      487 |       1 |
|                      499 |       1 |
|                      500 |       1 |
|                      502 |       1 |
|                      508 |       1 |
|                      514 |       1 |
|                      518 |       1 |
|                      521 |       1 |
|                      523 |       1 |
|                      525 |       1 |
|                      530 |       1 |
|                      532 |       1 |
|                      542 |       1 |
|                      545 |       1 |
|                      551 |       1 |
|                      564 |       2 |
|                      570 |       1 |
|                      571 |       1 |
|                      572 |       1 |
|                      573 |       1 |
|                      574 |       1 |
|                      586 |       1 |
|                      592 |       1 |
|                      594 |       1 |
|                      610 |       1 |
|                      615 |       1 |
|                      623 |       1 |
|                      633 |       1 |
|                      640 |       1 |
|                      641 |       1 |
|                      643 |       1 |
|                      660 |       1 |
|                      667 |       1 |
|                      668 |       1 |
|                      671 |       1 |
|                      681 |       1 |
|                      696 |       1 |
|                      697 |       1 |
|                      713 |       1 |
|                      715 |       1 |
|                      723 |       1 |
|                      727 |       1 |
|                      736 |       1 |
|                      742 |       1 |
|                      789 |       1 |
|                      796 |       1 |
|                      820 |       1 |
|                      827 |       1 |
|                      830 |       1 |
|                      835 |       1 |
|                      859 |       1 |
|                      882 |       1 |
|                      910 |       1 |
|                      929 |       1 |
|                      938 |       1 |
|                      969 |       1 |
|                     1060 |       1 |
|                     1131 |       1 |
|                     1150 |       1 |
|                     1182 |       2 |
|                     1355 |       1 |
|                     1369 |       1 |
|                     1374 |       1 |
|                     1392 |       1 |
|                     1466 |       1 |
|                     2497 |       1 |
|                     2528 |       1 |
|                     3069 |       1 |
|                     3655 |       1 |
|                     3694 |       1 |
|                     4004 |       1 |
|                     4101 |       1 |
|                     4187 |       1 |
|                     9654 |       1 |
|                    13712 |       1 |
|                    19667 |       1 |
|                    21356 |       1 |
|                 33358308 |       1 |
+--------------------------+---------+
466 tuples (12.8s)
drop table device_id_nb_tmp;
operation successful (0.0s)
alter table train 
      drop column nnb;
operation successful (0.0s)

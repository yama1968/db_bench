SELECT click, count(*)
  FROM (
        SELECT t.id, t.my_hour as my_hour, t.click, t.device_id, DID.p, DID.nnb
          FROM Train AS t
          JOIN (
                SELECT device_id, count(*) as nnb, avg(click) as p
                  FROM Train
                 GROUP BY device_id
            ) AS DID
            ON t.device_id = DID.device_id
    ) AS A
 GROUP BY click
 ORDER BY click;
+-------+----------+
| click | L21      |
+=======+==========+
|     0 | 33563901 |
|     1 |  6865066 |
+-------+----------+
2 tuples (2.8s)
SELECT t.id, t.my_hour as my_hour, t.click, t.device_id, DID.p, DID.nnb
   FROM Train AS t
   JOIN (
         SELECT device_id, count(*) as nnb, avg(click) as p
           FROM Train
          GROUP BY device_id
     ) AS DID
     ON t.device_id = DID.device_id
     ORDER BY p 
  LIMIT 20;
+----------------------+----------+-------+-----------+--------------------------+------+
| id                   | my_hour  | click | device_id | p                        | nnb  |
+======================+==========+=======+===========+==========================+======+
| 10006192453619779489 | 14102100 |     0 | 6a943594  |                        0 |    6 |
| 10006777279679619273 | 14102100 |     0 | 4b2309e9  |                        0 |   38 |
| 10007768440836622373 | 14102100 |     0 | 432cd280  |                        0 |  215 |
| 10007830732992705885 | 14102100 |     0 | 890abcbb  |                        0 |   24 |
| 10013493678511778479 | 14102100 |     0 | a2cbb1e0  |                        0 |    2 |
| 10018255614280682659 | 14102100 |     0 | b45aada4  |                        0 |    2 |
| 10018283997673108970 | 14102100 |     0 | 03cb167d  |                        0 |    7 |
| 10022961149355219548 | 14102100 |     0 | bd7c02a1  |                        0 |    1 |
| 10024365483589149864 | 14102100 |     0 | 9906e40c  |                        0 |    1 |
| 10025633842336165171 | 14102100 |     0 | a7420ec6  |                        0 |    1 |
| 10030114320949150367 | 14102100 |     0 | bd544220  |                        0 |   17 |
| 10031428004855986706 | 14102100 |     0 | b36096d3  |                        0 |    1 |
| 10031650492433703486 | 14102100 |     0 | 2a5eebfd  |                        0 |    1 |
| 10034295299322669964 | 14102100 |     0 | 30f17f5f  |                        0 |    1 |
| 10035306195717534065 | 14102100 |     0 | 1c6dc527  |                        0 |    4 |
| 10035307561141164611 | 14102100 |     0 | 7f4b1f1e  |                        0 |    8 |
| 10035581580342578168 | 14102100 |     0 | 6b17789a  |                        0 |    7 |
| 10044544651732520383 | 14102100 |     0 | cb1fc8bd  |                        0 |    3 |
| 10045015900189972745 | 14102100 |     0 | f289c0ef  |                        0 |    7 |
| 10047913575991848385 | 14102100 |     0 | 266f36a6  |                        0 |    2 |
+----------------------+----------+-------+-----------+--------------------------+------+
20 tuples (2.9s)
